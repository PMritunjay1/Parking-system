<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>
        Report - Parkify
    </title>
    <link rel="icon" type="image/png" href="logo.png">
    <!-- Brand typography: Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;300;400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Font Awesome 6 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet" />
    <!-- Flatpickr (date/week picker) -->
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet" />
    <!-- SweetAlert2 -->
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.7/dist/sweetalert2.min.css" rel="stylesheet" />
    <!-- Global Theme CSS -->
    <link href="style.css" rel="stylesheet" />
    <!-- Page-specific CSS -->
    <link href="reports_page.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/utc.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/timezone.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
    <script>
        (function () {
            const token = localStorage.getItem('accessToken');
            if (!token) {

                window.location.replace('./index.html');
            }
        })();
    </script>
</head>

<body class="min-vh-100 d-flex flex-column bg-muted border-bottom">
    <!-- Header (Common Component: needed on Reports Page) -->
    <nav class="navbar navbar-dark manager-navbar px-3">
        <div class="dropdown d-xl-none p-2">
            <button class="btn btn-outline-light me-2 d-lg-none " data-bs-target="#managerNav" data-bs-toggle="dropdown"
                type="button">
                <i class="fa-solid fa-bars">
                </i>
            </button>
            <ul class="dropdown-menu ex w-100">
                <li><a class="dropdown-item" href="./admin_dashboard.html"><i class="fa-solid fa-gauge-high me-2">
                        </i>KPI Dashboard</a></li>
                <li><a class="dropdown-item" href="./reports_page.html"><i class="fa-solid fa-chart-line me-2">
                        </i>Weekly Report</a></li>
                <li><a class="dropdown-item" href="#revenue"><i class="fa-solid fa-coins me-2">
                        </i>Revenue by Lot</a></li>
                <li><a class="dropdown-item" href="#occupancy"><i class="fa-solid fa-chart-area me-2">
                        </i>Occupancy Trends</a></li>
                <li><a class="dropdown-item" href="#penalties"><i class="fa-solid fa-ticket me-2">
                        </i>Penalties Overview</a></li>
                <li><a class="dropdown-item" href="#settings"><i class="fa-solid fa-user-gear me-2">
                        </i>Profile &amp; Settings</a></li>
            </ul>
        </div>

        <a class="navbar-brand d-flex align-items-center gap-2" href="admin_dashboard.html">
            <img alt="Logo" onerror="this.onerror=null;" src="logo.png" style="height:28px;" />
            <span>
                Parkify
            </span>
        </a>

        <div class="ms-auto d-flex align-items-center gap-2">
            <div class="dropdown me-2">
                <button class="btn btn-sm btn-outline-light dropdown-toggle" data-bs-toggle="dropdown">
                    <i class="fa-solid fa-calendar-week me-1">
                    </i>
                    Select Week
                </button>
                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark">
                    <li>
                        <a class="dropdown-item js-quick-week" data-range="this">
                            This Week
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item js-quick-week" data-range="last">
                            Last Week
                        </a>
                    </li>
                </ul>
            </div>
            <a class="btn btn-sm export-btn" href="#export" id="btnHeaderExport">
                <i class="fa-solid fa-file-pdf me-1">
                </i>
                Export PDF
            </a>
            <div class="dropdown">
                <a class="btn btn-sm btn-outline-light dropdown-toggle" data-bs-toggle="dropdown">
                    <i class="fa-solid fa-user-tie me-1">
                    </i>
                    Mritunjay
                </a>
                <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark">
                    <li>
                        <a class="dropdown-item" href="#settings">
                            <i class="fa-solid fa-user-gear me-2">
                            </i>
                            Settings
                        </a>
                    </li>
                    <li>
                        <hr class="dropdown-divider" />
                    </li>
                    <li>
                        <a class="dropdown-item" href="#" id="logoutButton">
                            <i class="fa-solid fa-right-from-bracket me-2"></i>
                            Logout
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- Main layout: Sidebar + Content -->
    <div class="flex-grow-1 d-flex">
        <!-- Sidebar (Common Component: needed on Reports Page) -->
        <aside class="d-none d-lg-flex flex-column vh-100 p-3" id="sidebarManager">
            <div class="d-flex align-items-center justify-content-between brand-area mb-3">
                <div class="d-flex align-items-center gap-2">
                    <img alt="Logo" onerror="this.onerror=null;" src="manag.jpg"
                        style=" border-radius: 50%;  width: 45px;  height: 45px; object-fit: cover;" />
                    <span class="fw-semibold">
                        Report Area
                    </span>
                </div>
                <button class="btn btn-outline-light me-2 d-lg-none" type="button" data-bs-toggle="offcanvas"
                    data-bs-target="#sidebarManagerOffcanvas" aria-controls="sidebarManagerOffcanvas">
                    <i class="fa-solid fa-bars"></i>
                </button>
            </div>


            <div class="profile d-flex align-items-center gap-2 p-2 mb-3">
                <img alt="avatar" class="rounded-circle"
                    onerror="this.onerror=null;this.src='https://picsum.photos/seed/manager/72/72';"
                    src="https://ui-avatars.com/api/?name=Manager&amp;background=194542&amp;color=fff"
                    style="width:36px;height:36px;" />
                <div>
                    <div class="fw-semibold">
                        Mritunjay Pandey
                    </div>
                    <small class="text-muted">
                        Manager
                    </small>
                </div>
            </div>
            <nav class="nav flex-column collapse show" id="managerNav">
                <a class="nav-link" href="./admin_dashboard.html">
                    <i class="fa-solid fa-gauge-high me-2">
                    </i>
                    KPIs Dashboard
                </a>
                <a class="nav-link active" href="./reports_page.html">
                    <i class="fa-solid fa-chart-line me-2">
                    </i>
                    Weekly Reports
                </a>
                <a class="nav-link" href="#revenue">
                    <i class="fa-solid fa-coins me-2">
                    </i>
                    Revenue by Lot
                </a>
                <a class="nav-link" href="#occupancy">
                    <i class="fa-solid fa-chart-area me-2">
                    </i>
                    Occupancy Trends
                </a>
                <a class="nav-link" href="#penalties">
                    <i class="fa-solid fa-ticket me-2">
                    </i>
                    Penalties Overview
                </a>
                <hr class="border-secondary" />
                <a class="nav-link" href="#settings">
                    <i class="fa-solid fa-user-gear me-2">
                    </i>
                    Profile &amp; Settings
                </a>
            </nav>

        </aside>
        <!-- Main content area -->
        <main class="flex-grow-1">
            <div class="container-fluid p-3 p-md-4">
                <!-- Breadcrumbs and page header -->
                <div class="bg-muted border-bottom">

                    <nav aria-label="breadcrumb" class="container-max pill-nav mb-0 d-none d-md-flex">
                        <span class="breadcrumb-item">
                            <a href="./entry_gate.html">Entry Gate</a>
                        </span>
                        <span class="breadcrumb-item">
                            <a href="./exit_gate.html">Exit Gate</a>
                        </span>
                        <span class="breadcrumb-item">
                            <a href="./index.html">Login</a>
                        </span>
                        <span class="breadcrumb-item">
                            <a href="./admin_dashboard.html">Admin</a>
                        </span>
                        <span class="breadcrumb-item">
                            <a href="./records_search.html">Records</a>
                        </span>
                        <span class="breadcrumb-item">
                            <a href="./reports_page.html" class="active">Reports</a>
                        </span>
                    </nav>

                    <div class="dropdown d-md-none p-2">
                        <button class="btn btn-secondary dropdown-toggle w-100" type="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            <i class="fa-solid fa-bars me-2"></i> Quick Navigation
                        </button>
                        <ul class="dropdown-menu w-100">
                            <li><a class="dropdown-item" href="./entry_gate.html">Entry Gate</a></li>
                            <li><a class="dropdown-item" href="./exit_gate.html">Exit Gate</a></li>
                            <li><a class="dropdown-item" href="./index.html">Login</a></li>
                            <li><a class="dropdown-item" href="./admin_dashboard.html">Admin</a></li>
                            <li><a class="dropdown-item" href="./records_search.html">Records</a></li>
                            <li><a class="dropdown-item" href="./reports_page.html">Reports</a></li>
                        </ul>
                    </div>

                </div>
                <div class="page-header">
                    <div>

                        <h1 class="page-title">
                            Weekly Reports
                        </h1>
                        <small class="text-muted">
                            Generate, review, and export weekly revenue and occupancy insights
                        </small>
                    </div>
                    <div class="reveal-on-hover">
                        <div class="view-switcher">
                            <span class="option active">
                                <i class="fa-solid fa-table">
                                </i>
                            </span>
                            <span class="option">
                                <i class="fa-solid fa-grip">
                                </i>
                            </span>
                        </div>
                    </div>
                </div>
                <!-- System Feedback Toasts -->
                <div class="position-fixed top-0 end-0 p-3" style="z-index: 1080">
                    <div aria-atomic="true" aria-live="assertive"
                        class="toast align-items-center text-bg-primary border-0" id="toastArea" role="alert">
                        <div class="d-flex">
                            <div class="toast-body">
                                <i class="fa-solid fa-circle-check me-2">
                                </i>
                                Report generated successfully.
                            </div>
                            <button aria-label="Close" class="btn-close btn-close-white me-2 m-auto"
                                data-bs-dismiss="toast" type="button">
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Report Filters -->
                <section class="app-card mb-4">
                    <div class="card-header">
                        <div class="title d-flex align-items-center gap-2">
                            <i class="fa-solid fa-filter">
                            </i>
                            <span class="widget-title">
                                Report Filters
                            </span>
                        </div>
                        <div class="text-muted small">
                            Select report type and week, then click Generate
                        </div>
                    </div>
                    <div class="card-body">
                        <form class="row g-3 align-items-end" id="reportFilters">
                            <div class="col-sm-6 col-md-4">
                                <label class="form-label" for="reportType">
                                    Report Type
                                </label>
                                <select class="form-select" id="reportType" required="">
                                    <option disabled="" selected="" value="">
                                        Select type
                                    </option>
                                    <option>
                                        Weekly Revenue
                                    </option>
                                    <option>
                                        Weekly Occupancy
                                    </option>
                                </select>
                            </div>
                            <div class="col-sm-6 col-md-4">
                                <label class="form-label" for="weekPicker">
                                    Select Week
                                </label>
                                <input autocomplete="off" class="form-control" id="weekPicker"
                                    placeholder="Pick a week" />
                                <div class="form-text">
                                    Past weeks only
                                </div>
                            </div>
                            <div class="col-sm-12 col-md-4 d-flex gap-2">
                                <button class="btn btn-primary flex-grow-1" disabled="" id="btnGenerate" type="button">
                                    <span class="me-1">
                                        <i class="fa-solid fa-gear">
                                        </i>
                                    </span>
                                    <span class="btn-text">
                                        Generate Report
                                    </span>
                                    <span aria-hidden="true" class="spinner-border spinner-border-sm ms-2 d-none"
                                        id="genSpinner" role="status">
                                    </span>
                                </button>
                                <button class="btn btn-light" id="btnReset" title="Reset filters" type="button">
                                    <i class="fa-solid fa-rotate">
                                    </i>
                                </button>
                            </div>
                        </form>
                    </div>
                </section>
                <!-- Report Display Area -->

                <section class="grid gap-3" id="reportArea">
                    <!-- Empty State (shown initially) -->
                    <div class="empty-state" id="emptyState">
                        <img alt="placeholder" class="mb-2 rounded" src="image.png">
                        <h5 class="text-strong">
                            No report generated yet
                        </h5>
                        <p class="empty-state-text">
                            Select a report type and week, then click Generate Report to view insights here.
                        </p>
                        <button class="btn btn-secondary" onclick="document.getElementById('reportType').focus()"
                            type="button">
                            <i class="fa-solid fa-arrow-turn-down me-1">
                            </i>
                            Get Started
                        </button>
                        </img>
                    </div>
                    <!-- Loading State -->
                    <div class="loading-state d-none" id="loadingState">
                        <div class="w-100">
                            <div class="skeleton mb-3" style="height:20px;width:60%">
                            </div>
                            <div class="grid auto-fit-md">
                                <div class="skeleton" style="height:100px">
                                </div>
                                <div class="skeleton" style="height:100px">
                                </div>
                                <div class="skeleton" style="height:100px">
                                </div>
                            </div>
                            <div class="skeleton mt-4" style="height:280px">
                            </div>
                            <div class="skeleton mt-3" style="height:280px">
                            </div>
                        </div>
                    </div>
                    <!-- Report Content (shown after generation) -->
                    <div class="d-none" id="reportContent">
                        <!-- Report header with export -->
                        <div class="app-card mb-3" id="reportHeaderCard">
                            <div class="card-header">
                                <div>
                                    <div class="widget-title" id="reportTitle">
                                        Weekly Report
                                    </div>
                                    <small class="text-muted" id="reportSubtitle">
                                        —
                                    </small>
                                </div>
                                <div>
                                    <button class="btn btn-info" disabled="" id="btnExport">
                                        <i class="fa-solid fa-file-arrow-down me-1">
                                        </i>
                                        Export to PDF
                                    </button>
                                </div>
                            </div>
                            <div class="card-body py-3">
                                <div class="d-flex flex-wrap gap-2 align-items-center">
                                    <span class="badge-soft info">
                                        <i class="fa-solid fa-calendar-week me-1">
                                        </i>
                                        <span id="badgeWeek">
                                            Week
                                        </span>
                                    </span>
                                    <span class="badge-soft primary" id="badgeType">
                                        <i class="fa-solid fa-layer-group me-1">
                                        </i>
                                        Type
                                    </span>
                                </div>
                            </div>
                        </div>
                        <!-- Key Metrics Summary -->
                        <div class="grid auto-fit-lg" id="metricsRow">
                            <!-- Metrics will be injected -->
                        </div>
                        <!-- Chart Card -->
                        <div id="revenue" class="app-card mt-3">
                            <div class="card-header">
                                <div class="title d-flex align-items-center gap-2">
                                    <i class="fa-solid fa-chart-column">
                                    </i>
                                    <span class="widget-title" id="chartTitle">
                                        Report Chart
                                    </span>
                                </div>
                                <div class="text-muted small" id="chartSubtitle">
                                    Interactive chart with tooltips and zoom
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="chart-wrap">
                                    <canvas aria-label="Report Chart" height="140" id="reportChart" role="img">
                                    </canvas>
                                </div>
                            </div>
                        </div>
                        <section id="penalties" class="report-section d-none mt-3">
                            <div class="app-card">
                                <div class="card-header">
                                    <h5 class="widget-title mb-0"><i class="fa-solid fa-ticket me-2"></i>Penalties
                                        Overview</h5>
                                </div>
                                <div class="card-body">
                                    <p class="text-muted mb-2">Total amount collected from penalties (e.g., lost
                                        tickets) in the selected period.</p>
                                    <div class="metric-card simple">
                                        <div class="metric-title">Revenue from Penalties</div>
                                        <div class="metric-value" id="penaltiesTotalAmount">--</div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <!-- Table Controls -->
                        <div class="d-flex align-items-center justify-content-between mt-4 mb-2 gap-2 flex-wrap"
                            id="tableControls">
                            <div class="d-flex align-items-center gap-2">
                                <div class="input-group input-group-sm" style="max-width: 260px;">
                                    <span class="input-group-text">
                                        <i class="fa-solid fa-magnifying-glass">
                                        </i>
                                    </span>
                                    <input class="form-control" id="tableSearch" placeholder="Filter table..."
                                        type="text" />
                                </div>
                                <div class="form-text">
                                    Click headers to sort
                                </div>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <label class="small text-muted">
                                    Rows per page
                                </label>
                                <select class="form-select form-select-sm" id="rowsPerPage" style="width:90px;">
                                    <option>
                                        5
                                    </option>
                                    <option selected="">
                                        10
                                    </option>
                                    <option>
                                        20
                                    </option>
                                </select>
                            </div>
                        </div>
                        <!-- Detailed Report Table -->
                        <div class="app-card" id="reportTableCard">
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-theme mb-0" id="reportTable">
                                        <thead id="tableHead">
                                            <!-- Dynamic columns -->
                                        </thead>
                                        <tbody id="tableBody">
                                            <!-- Dynamic rows -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="card-footer d-flex align-items-center justify-content-between flex-wrap gap-2">
                                <div class="small text-muted" id="paginationInfo">
                                    Showing 0 to 0 of 0 entries
                                </div>
                                <nav>
                                    <ul class="pagination pagination-sm mb-0" id="pagination">
                                        <!-- Pagination items injected -->
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- Secondary navigation links (site pages) -->
                <div class="mt-4">
                    <div class="auxiliary-links small">
                        <a href="./entry_gate.html">
                            <i class="fa-solid fa-door-open me-1">
                            </i>
                            Entry Gate
                        </a>
                        <a href="./exit_gate.html">
                            <i class="fa-solid fa-door-closed me-1">
                            </i>
                            Exit Gate
                        </a>
                        <a href="./records_search.html">
                            <i class="fa-solid fa-magnifying-glass me-1">
                            </i>
                            Records Search
                        </a>
                        <a href="./admin_dashboard.html">
                            <i class="fa-solid fa-gauge-high me-1">
                            </i>
                            Admin Dashboard
                        </a>
                        <a class="text-strong" href="./reports_page.html">
                            <i class="fa-solid fa-chart-line me-1">
                            </i>
                            Reports Page
                        </a>
                        <a href="./index.html">
                            <i class="fa-solid fa-right-to-bracket me-1">
                            </i>
                            Login
                        </a>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <!-- Footer (Common Component: needed on Reports Page) -->
    <footer class="manager-footer mt-auto py-2 px-3">
        <div class="d-flex flex-column flex-md-row align-items-center justify-content-between gap-2">
            <div class="d-flex align-items-center gap-3 small">
                <a href="./admin_dashboard.html">
                    <i class="fa-solid fa-gauge-high me-1">
                    </i>
                    KPIs
                </a>
                <a href="./reports_page.html">
                    <i class="fa-solid fa-chart-line me-1">
                    </i>
                    Reports
                </a>


            </div>
            <button type="button" class="btn btn-sm btn-outline-light" data-bs-toggle="modal"
                data-bs-target="#contactModal">
                <i class="fa-solid fa-envelope me-1"></i> Contact Us
            </button>
            <div class="d-flex align-items-center gap-3 small">
                <a href="#terms">
                    Terms
                </a>
                <a href="#privacy">
                    Privacy
                </a>
                <span class="text-muted">
                    © 2025 Parking System
                </span>
            </div>
        </div>
    </footer>
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/plugins/weekSelect/weekSelect.min.js">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.10.7/dist/sweetalert2.all.min.js">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.umd.min.js">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js">
    </script>
    <script src="reports_page.js" defer></script>

    <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contactModalLabel"><i class="fa-solid fa-paper-plane me-2"></i>Contact
                        Support</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted small">If you have any questions or need assistance, please fill out the form
                        below. Our team will get back to you shortly.</p>
                    <form id="contactForm">
                        <div class="mb-3">
                            <label for="contactName" class="form-label">Your Name</label>
                            <input type="text" class="form-control" id="contactName" required>
                        </div>
                        <div class="mb-3">
                            <label for="contactEmail" class="form-label">Your Email</label>
                            <input type="email" class="form-control" id="contactEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="contactMessage" class="form-label">Message</label>
                            <textarea class="form-control" id="contactMessage" rows="4" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="sendMessageBtn">Send Message</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>