<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Entry Gate - Parking Kiosk</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" />
    <link href="style.css" rel="stylesheet" />
    <link href="entry_gate.css" rel="stylesheet" />
    <style>
        :root {
            --primary: #03011d;
            --secondary: #194542;
        }

        #sidebarGate {
            width: 260px;
            background: var(--primary);
            color: #eaeaea;
        }

        #sidebarGate .brand-area {
            border-bottom: 1px solid rgba(255, 255, 255, .08);
        }

        #sidebarGate .nav .nav-link {
            color: #cfd3d7;
            border-radius: .35rem;
        }

        #sidebarGate .nav .nav-link:hover {
            background: rgba(25, 69, 66, .25);
            color: #fff;
        }

        #sidebarGate .nav .nav-link.active {
            background: var(--secondary);
            color: #fff;
        }

        @media (max-width: 991.98px) {
            #sidebarGate {
                display: none;
            }
        }

        .gate-navbar {
            background: #03011d;
        }

        .gate-navbar .navbar-brand span {
            color: #fff;
        }

        .gate-navbar .attn-btn {
            background: #194542;
            color: #fff;
            border: 0;
        }

        .gate-navbar .attn-btn:hover {
            filter: brightness(1.05);
        }

        .gate-clock {
            color: #cfd3d7;
        }

        .gate-footer {
            background: #0f1230;
            color: #cfd3d7;
            position: sticky;
            bottom: 0;
        }

        .gate-footer a {
            color: #cfd3d7;
            text-decoration: none;
        }

        .gate-footer a:hover {
            color: #ffffff;
            text-decoration: underline;
        }

        @media (max-width: 875px) {
            .gate-footer {
                position: relative !important;
            }
        }
    </style>
</head>

<body>
    <div class="d-flex">
        <div class="flex-grow-1 d-flex flex-column min-vh-100">
            <nav class="navbar navbar-expand-lg navbar-dark gate-navbar px-3">
                <a class="navbar-brand d-flex align-items-center gap-2" href="./entry_gate.html">
                    <img alt="Logo" src="logo.png" style="height:28px;" />
                    <span> Parking System</span>
                </a>
                <div class="ms-auto d-flex align-items-center gap-2 gap-md-3">
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-light dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fa-solid fa-compass me-1"></i> Navigate
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark">
                            <li><a class="dropdown-item" href="./entry_gate.html">Entry Gate</a></li>
                            <li><a class="dropdown-item" href="./exit_gate.html">Exit Gate</a></li>
                            <li><a class="dropdown-item" href="./index.html">Login</a></li>
                            <li><a class="dropdown-item" href="./admin_dashboard.html">Admin Dashboard</a></li>
                            <li><a class="dropdown-item" href="./records_search.html">Records Search</a></li>
                            <li><a class="dropdown-item" href="./reports_page.html">Reports</a></li>
                        </ul>
                    </div>
                    <div class="dropdown">
                        <button class="btn btn-sm btn-outline-light dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="fa-solid fa-language me-1"></i> Language
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark">
                            <li><a class="dropdown-item" data-lang="en" href="#">English</a></li>
                            <li><a class="dropdown-item" data-lang="hi" href="#">हिंदी</a></li>
                        </ul>
                    </div>
                    <button class="btn attn-btn btn-sm" id="callAttendant">
                        <i class="fa-solid fa-headset me-1"></i>Call Attendant
                    </button>
                    <div class="gate-clock small">
                        <i class="fa-solid fa-clock me-1"></i><span id="gateTime">--:--</span>
                    </div>
                </div>
            </nav>
            <div class="flex-grow-1 d-flex">
                <!-- Common Gate Terminal Sidebar (Entry & Exit Kiosks) -->
                <style>
                    :root {
                        --primary: #03011d;
                        --secondary: #194542;
                    }

                    #sidebarGate {
                        width: 260px;
                        background: var(--primary);
                        color: #eaeaea;
                    }

                    #sidebarGate .brand-area {
                        border-bottom: 1px solid rgba(255, 255, 255, .08);
                    }

                    #sidebarGate .nav .nav-link {
                        color: #cfd3d7;
                        border-radius: .35rem;
                    }

                    #sidebarGate .nav .nav-link:hover {
                        background: rgba(25, 69, 66, .25);
                        color: #fff;
                    }

                    #sidebarGate .nav .nav-link.active {
                        background: var(--secondary);
                        color: #fff;
                    }
                </style>
                <aside class="d-none d-md-flex flex-column vh-100 p-3" id="sidebarGate">
                    <div class="brand-area d-flex align-items-center gap-2 mb-3">
                        <img alt="Logo" onerror="this.onerror=null;this.src='https://picsum.photos/seed/logo/72/72'"
                            src="https://dsaishared.blob.core.windows.net/uxcceleratecontainer/projects/68aefca48ecfc2752de0a4e6/logos/logo_8a6ad475-2595-482f-9695-3ec60565bb2a.png"
                            style="height:36px;" />
                        <span class="fw-semibold">
                            Parking Kiosk
                        </span>
                    </div>
                    <nav class="nav flex-column mt-2">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#contactModal">
                            <i class="fa-solid fa-circle-question me-2"></i> Help
                        </a>
                        <a class="nav-link" href="#lang">
                            <i class="fa-solid fa-language me-2">
                            </i>
                            Language
                        </a>
                        <a class="nav-link" href="#safety">
                            <i class="fa-solid fa-shield-heart me-2">
                            </i>
                            Safety Tips
                        </a>
                    </nav>
                    <div class="mt-auto small text-muted">
                        For assistance, press the 'Need Help' button on screen.
                    </div>
                    <!-- Icons used: fa-circle-question, fa-language, fa-shield-heart -->
                </aside>
                <main class="container-fluid py-3 py-md-4 flex-grow-1">
                    <div class="bg-muted border-bottom">

                        <nav aria-label="breadcrumb" class="container-max pill-nav mb-0 d-none d-md-flex">
                            <span class="breadcrumb-item">
                                <a href="./entry_gate.html" class="active">Entry Gate</a>
                            </span>
                            <span class="breadcrumb-item">
                                <a href="./exit_gate.html">Exit Gate</a>
                            </span>
                            <span class="breadcrumb-item">
                                <a href="./index.html">Login</a>
                            </span>
                            <span class="breadcrumb-item">
                                <a href="./admin_dashboard.html">Admin</a>
                            </span>
                            <span class="breadcrumb-item">
                                <a href="./records_search.html">Records</a>
                            </span>
                            <span class="breadcrumb-item">
                                <a href="./reports_page.html">Reports</a>
                            </span>
                        </nav>

                        <div class="dropdown d-md-none p-2">
                            <button class="btn btn-secondary dropdown-toggle w-100" type="button"
                                data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fa-solid fa-bars me-2"></i> Quick Navigation
                            </button>
                            <ul class="dropdown-menu w-100">
                                <li><a class="dropdown-item" href="./entry_gate.html">Entry Gate</a></li>
                                <li><a class="dropdown-item" href="./exit_gate.html">Exit Gate</a></li>
                                <li><a class="dropdown-item" href="./index.html">Login</a></li>
                                <li><a class="dropdown-item" href="./admin_dashboard.html">Admin</a></li>
                                <li><a class="dropdown-item" href="./records_search.html">Records</a></li>
                                <li><a class="dropdown-item" href="./reports_page.html">Reports</a></li>
                            </ul>
                        </div>

                    </div>
                    <div class="row justify-content-center">
                        <div class="col-12 col-lg-10 col-xl-8">
                            <section class="app-card kiosk-card" id="entryFlowManager">
                                <div class="card-header">
                                    <div class="d-flex align-items-center gap-2">
                                        <i class="fa-solid fa-right-to-bracket text-primary"></i>
                                        <span class="widget-title">Vehicle Entry</span>
                                    </div>
                                    <div class="text-muted small" id="stepIndicator">Welcome</div>
                                </div>
                                <div class="card-body">
                                    <div class="flow-step" data-step="welcome">
                                        <div class="text-center mb-4">
                                            <h1 class="fw-bold mb-2">Welcome </h1>
                                            <p class="text-muted">Touch the button below to begin</p>
                                        </div>
                                        <div class="row g-3 align-items-stretch mb-4">
                                            <div class="col-12 col-md-6">
                                                <div class="p-3 rounded border h-100 bg-info-soft">
                                                    <div class="d-flex align-items-center mb-2">
                                                        <i class="fa-solid fa-receipt text-info me-2"></i>
                                                        <strong>Parking Fees</strong>
                                                    </div>
                                                    <div class="small text-dark" id="feeDisplay"></div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-6">
                                                <div class="p-3 rounded border h-100 bg-success-soft">
                                                    <div class="d-flex align-items-center mb-2">
                                                        <i class="fa-solid fa-shield-halved text-success me-2"></i>
                                                        <strong>Notes</strong>
                                                    </div>
                                                    <ul class="small mb-0 ps-3">
                                                        <li>Keep your vehicle number ready</li>
                                                        <li>Digital ticket will be issued</li>
                                                        <li>No cash required at entry</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="d-grid">
                                            <button type="button" class="btn btn-primary btn-lg py-3" id="startButton">
                                                <i class="fa-solid fa-hand-pointer me-2"></i> Tap to Enter
                                            </button>
                                        </div>
                                    </div>

                                    <div class="flow-step" data-step="selectType">
                                        <div class="text-center mb-3">
                                            <h2 class="fw-semibold mb-1">Please select your vehicle type</h2>
                                            <p class="text-muted">Tap to choose one</p>
                                        </div>
                                        <div class="row g-3" id="vehicleTypeGrid"></div>
                                        <div class="mt-3">
                                            <button type="button" class="btn btn-light" id="backToWelcome">
                                                <i class="fa-solid fa-arrow-left me-2"></i> Back
                                            </button>
                                        </div>
                                    </div>

                                    <div class="flow-step" data-step="enterNumber">
                                        <div class="text-center mb-3">
                                            <h2 class="fw-semibold mb-1">Enter your vehicle number</h2>
                                            <p class="text-muted">Use the on-screen keyboard below</p>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Vehicle Number</label>
                                            <div aria-live="polite"
                                                class="number-display-field form-control form-control-lg"
                                                id="numberDisplay"></div>
                                            <div class="form-text">Example: KA01AB1234</div>
                                        </div>
                                        <div aria-label="On-screen keyboard" class="keyboard-grid" id="keyboardGrid">
                                        </div>
                                        <div class="d-flex gap-2 mt-3">
                                            <button type="button" class="btn btn-light" id="backToType">
                                                <i class="fa-solid fa-arrow-left me-2"></i> Back
                                            </button>
                                            <button type="button" class="btn btn-success ms-auto" id="confirmNumber">
                                                <i class="fa-solid fa-check me-2"></i> Confirm
                                            </button>
                                        </div>
                                    </div>

                                    <div class="flow-step" data-step="processing">
                                        <div class="processing-view text-center py-5">
                                            <div aria-hidden="true" class="spinner-border text-primary mb-3"
                                                role="status">
                                            </div>
                                            <h3 class="mb-1">Processing your entry...</h3>
                                            <p class="text-muted">Please wait while we issue your ticket</p>
                                        </div>
                                    </div>

                                    <div class="flow-step" data-step="displayTicket">
                                        <div class="text-center mb-3">
                                            <h2 class="fw-semibold">Your Digital Ticket</h2>
                                            <p class="text-muted">Show this at the exit or scan if prompted</p>
                                        </div>
                                        <div class="row g-3 align-items-stretch">
                                            <div class="col-12 col-md-6">
                                                <div
                                                    class="qr-panel p-3 rounded border h-100 d-flex align-items-center justify-content-center">
                                                    <div aria-label="QR Code" class="qr-code" id="qrcode"></div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-6">
                                                <div class="p-3 rounded border h-100">
                                                    <ul class="list-unstyled mb-0" id="ticketDetails"></ul>
                                                    <div class="alert alert-success mt-3 mb-0">
                                                        <i class="fa-solid fa-door-open me-2"></i> Barrier opening...
                                                        Please
                                                        proceed.
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-center mt-3">
                                            <p class="text-muted small">This screen will reset in 1 minute.</p>
                                            <button type="button" class="btn btn-secondary mt-2" id="newEntryButton">
                                                <i class="fa-solid fa-rotate-right me-2"></i> Start New Entry
                                            </button>
                                        </div>
                                    </div>

                                    <div class="flow-step" data-step="status">
                                        <div class="status-screen text-center py-5">
                                            <div class="display-5 mb-3" id="statusIcon"></div>
                                            <h3 class="mb-2" id="statusMessage"></h3>
                                            <p class="text-muted">Returning to welcome screen shortly...</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="card-footer d-flex align-items-center justify-content-between">
                                    <div class="small text-muted"><i class="fa-solid fa-circle-info me-1"></i>
                                        Touch-friendly interface</div>
                                    <div class="small"><span class="badge-soft info"><i
                                                class="fa-solid fa-car-side me-1"></i><span id="selectedTypeBadge">No
                                                type
                                                selected</span></span></div>
                                </div>
                            </section>
                        </div>
                    </div>
                </main>
            </div>

            <footer class="gate-footer mt-auto py-2 px-3">
                <div class="d-flex align-items-center justify-content-between gap-2">
                    <small>By proceeding, you agree to our <a href="#">Terms</a> and <a href="#">Privacy
                            Policy</a>.</small>
                    <button type="button" class="btn btn-sm btn-outline-light" data-bs-toggle="modal"
                        data-bs-target="#contactModal">
                        <i class="fa-solid fa-envelope me-1"></i> Contact Us
                    </button>
                    <small>© 2025 Parking System</small>
                </div>
            </footer>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/utc.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/timezone.js"></script>
    <script>
        dayjs.extend(window.dayjs_plugin_utc);
        dayjs.extend(window.dayjs_plugin_timezone);
    </script>

    <script>
        const API_BASE_URL = 'http://127.0.0.1:8000';

        // --- STATE MANAGEMENT ---
        const state = {
            currentStep: 'welcome',
            selectedVehicleType: '',
            inputValue: '',
            ticketDetails: null,
            errorMessage: '',
            resetTimerId: null
        };

        const config = {
            statusResetMs: 5000,
            numberMaxLen: 12
        };

        // --- DOM ELEMENTS ---
        const stepIndicator = document.getElementById('stepIndicator');
        const selectedTypeBadge = document.getElementById('selectedTypeBadge');
        const numberDisplay = document.getElementById('numberDisplay');

        // --- UI HELPER FUNCTIONS ---
        function setStep(step) {
            if (step === 'welcome') {
                console.trace("setStep('welcome') was called from this location:");
            }
            state.currentStep = step;
            document.querySelectorAll('.flow-step').forEach(s => s.classList.remove('active'));
            const target = document.querySelector(`.flow-step[data-step="${step}"]`);
            if (target) target.classList.add('active');
            stepIndicator.textContent = {
                welcome: 'Welcome',
                selectType: 'Select Vehicle Type',
                enterNumber: 'Enter Vehicle Number',
                processing: 'Processing',
                displayTicket: 'Ticket Issued',
                status: 'Status'
            }[step] || 'Vehicle Entry';
        }

        function resetFlow() {
            // This trace will tell us exactly what function called resetFlow.
            console.trace("resetFlow() was called from this location:");

            clearTimeout(state.resetTimerId);
            state.selectedVehicleType = '';
            state.inputValue = '';
            state.ticketDetails = null;
            document.getElementById('selectedTypeBadge').textContent = 'No type selected';
            document.getElementById('numberDisplay').textContent = '';
            // setStep('welcome');
        }

        // --- API INTEGRATION FUNCTIONS ---
        async function initializeKiosk() {
            try {
                const configData = await fetch(`${API_BASE_URL}/entry/config`).then(res => res.json());

                const feeDisplay = document.getElementById('feeDisplay');
                let feeHtml = '';
                for (const [key, value] of Object.entries(configData.fee_structure_details)) {
                    const formattedKey = key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                    feeHtml += `<li>${formattedKey}: ₹${value.toFixed(2)}</li>`;
                }
                feeDisplay.innerHTML = `<ul class="mb-0 ps-3">${feeHtml}</ul>`;

                const vehicleTypeGrid = document.getElementById('vehicleTypeGrid');
                const vehicleIcons = { 'Motorcycle': 'fa-motorcycle', 'Compact': 'fa-car-side', 'Large': 'fa-bus' };
                vehicleTypeGrid.innerHTML = configData.supported_vehicle_types.map(type => {
                    const icon = vehicleIcons[type] || 'fa-car';
                    return `<div class="col-6 col-md-4">
                                <button class="vehicle-type-btn btn btn-outline-secondary w-100 py-3" data-type="${type}">
                                    <i class="fa-solid ${icon} fa-2x d-block mb-2"></i>
                                    <span class="fw-semibold">${type}</span>
                                </button>
                            </div>`;
                }).join('');

            } catch (error) {
                console.error("Failed to load kiosk configuration:", error);
                const feeDisplay = document.getElementById('feeDisplay');
                feeDisplay.innerHTML = `<p class="text-danger m-0">Error: Could not connect to the parking server.</p>`;
            }
        }

        async function handleConfirm() {
            const vehicleNumber = state.inputValue.trim();
            if (!vehicleNumber) {
                Swal.fire({ icon: 'warning', title: 'Input Required', text: 'Please enter your vehicle number.' });
                return;
            }

            setStep('processing');
            try {
                const requestBody = {
                    vehicle_number: vehicleNumber,
                    vehicle_type: state.selectedVehicleType
                };

                const ticketData = await fetch(`${API_BASE_URL}/entry/ticket`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                }).then(res => {
                    if (!res.ok) return res.json().then(err => Promise.reject(err));
                    return res.json();
                });

                state.ticketDetails = {
                    ticketId: ticketData.ticket_id,
                    spotId: ticketData.spot_number,
                    entryTime: dayjs(ticketData.entry_time).tz("Asia/Kolkata").format('YYYY-MM-DD HH:mm:ss'),
                    vehicleNumber: vehicleNumber, // Use the cleaned input value
                    vehicleType: state.selectedVehicleType,
                    qrCodeData: ticketData.qr_code_data
                };
                onProcessSuccess();
            } catch (error) {
                console.error("Failed to issue ticket:", error);
                state.errorMessage = error.detail || 'System Error. Please try again.';
                onProcessFailure();
            }
        }

        // REPLACE your current onProcessSuccess function with this FINAL version

        function onProcessSuccess() {
            // This is the correct success function.
            setStep('displayTicket');

            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            new QRCode(qrContainer, {
                text: state.ticketDetails.qrCodeData,
                width: 220,
                height: 220
            });

            const list = document.getElementById('ticketDetails');
            list.innerHTML = `
        <li class="mb-2"><strong>Ticket ID:</strong> ${state.ticketDetails.ticketId}</li>
        <li class="mb-2"><strong>Spot:</strong> ${state.ticketDetails.spotId}</li>
        <li class="mb-2"><strong>Vehicle:</strong> ${state.ticketDetails.vehicleNumber}</li>
        <li class="mb-2"><strong>Type:</strong> ${state.ticketDetails.vehicleType}</li>
        <li class="mb-2"><strong>Entry Time:</strong> ${state.ticketDetails.entryTimeStr}</li>`;

            // The 60-second timer.
            state.resetTimerId = setTimeout(resetFlow, 600000);
        } function onProcessFailure() {
            setStep('status');
            const statusIcon = document.getElementById('statusIcon');
            const statusMessage = document.getElementById('statusMessage');
            statusIcon.innerHTML = '<i class="fa-solid fa-triangle-exclamation text-danger"></i>';
            statusMessage.textContent = state.errorMessage;
            state.resetTimerId = setTimeout(resetFlow, config.statusResetMs);
        }

        // --- INITIALIZE KEYBOARD AND EVENT LISTENERS ---
        const keyboardGrid = document.getElementById('keyboardGrid');
        const keys = [...'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', '-', 'BACK', 'CLEAR'];
        keyboardGrid.innerHTML = keys.map(k => {
            let content = k;
            if (k === 'BACK') content = `<i class='fa-solid fa-delete-left'></i>`;
            if (k === 'CLEAR') content = `<i class='fa-solid fa-eraser'></i>`;
            const btnClass = ['BACK', 'CLEAR'].includes(k) ? 'btn-light' : 'btn-outline-secondary';
            return `<button class="kb-key btn ${btnClass}" data-key="${k}">${content}</button>`;
        }).join('');

        document.getElementById('startButton').addEventListener('click', () => setStep('selectType'));
        document.getElementById('backToWelcome').addEventListener('click', resetFlow);
        // REPLACE your current 'confirmNumber' event listener with this
        document.getElementById('confirmNumber').addEventListener('click', (e) => {
            e.preventDefault(); // This line stops the browser's default reload action
            handleConfirm();
        });
        document.getElementById('backToType').addEventListener('click', () => setStep('selectType'));
        document.getElementById('newEntryButton').addEventListener('click', resetFlow);

        document.getElementById('vehicleTypeGrid').addEventListener('click', (e) => {
            const btn = e.target.closest('.vehicle-type-btn');
            if (!btn) return;
            state.selectedVehicleType = btn.dataset.type;
            selectedTypeBadge.textContent = state.selectedVehicleType;
            setStep('enterNumber');
        });
        // Add this with your other event listeners
        document.querySelectorAll('.dropdown-menu [data-lang]').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                const lang = e.currentTarget.getAttribute('data-lang');
                showToast('Language set to ' + (lang === 'en' ? 'English' : 'हिंदी'));
            });
        });
        keyboardGrid.addEventListener('click', (e) => {
            const keyBtn = e.target.closest('.kb-key');
            if (!keyBtn) return;
            const key = keyBtn.dataset.key;
            if (key === 'BACK') {
                state.inputValue = state.inputValue.slice(0, -1);
            } else if (key === 'CLEAR') {
                state.inputValue = '';
            } else if (state.inputValue.length < config.numberMaxLen) {
                state.inputValue += key;
            }
            numberDisplay.textContent = state.inputValue;
        });

        function updateTime() {
            const el = document.getElementById('gateTime');
            if (el) {
                el.textContent = dayjs().tz("Asia/Kolkata").format('HH:mm:ss');
            }
        }
        setInterval(updateTime, 1000);


        // --- PAGE LOAD INITIALIZATION ---
        window.addEventListener('DOMContentLoaded', () => {
            initializeKiosk();
            setStep('welcome');
            updateTime();
            setInterval(updateTime, 10000);
        });
        // This script should be placed in a <script> tag on pages where the modal exists
        document.addEventListener('DOMContentLoaded', function () {
            const sendMessageBtn = document.getElementById('sendMessageBtn');
            if (sendMessageBtn) {
                sendMessageBtn.addEventListener('click', function () {
                    // In a real app, you would gather form data and send it to your server here.
                    // Example: const name = document.getElementById('contactName').value;

                    // For now, we'll just show a success message.
                    Swal.fire({
                        icon: 'success',
                        title: 'Message Sent!',
                        text: 'Thank you for contacting us. We will get back to you shortly.',
                        timer: 2500,
                        showConfirmButton: false
                    });

                    // Close the modal
                    const contactModal = document.getElementById('contactModal');
                    const modal = bootstrap.Modal.getInstance(contactModal);
                    if (modal) {
                        modal.hide();
                    }
                });
            }
        });
    </script>
    <div class="modal fade" id="contactModal" tabindex="-1" aria-labelledby="contactModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="contactModalLabel"><i class="fa-solid fa-paper-plane me-2"></i>Contact
                        Support</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted small">If you have any questions or need assistance, please fill out the form
                        below. Our team will get back to you shortly.</p>
                    <form id="contactForm">
                        <div class="mb-3">
                            <label for="contactName" class="form-label">Your Name</label>
                            <input type="text" class="form-control" id="contactName" required>
                        </div>
                        <div class="mb-3">
                            <label for="contactEmail" class="form-label">Your Email</label>
                            <input type="email" class="form-control" id="contactEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="contactMessage" class="form-label">Message</label>
                            <textarea class="form-control" id="contactMessage" rows="4" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="sendMessageBtn">Send Message</button>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
